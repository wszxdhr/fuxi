# wheel-ai AI 工作流程指南

> 将本文件作为每轮提示的前置上下文，帮助 AI 自主完成从需求到 PR 的闭环。所有输出请保持中文，能落地的步骤直接执行，不要重复询问。

## 总体原则
- 充分利用持久化文件：`plan` 维护可执行计划，`notes` 记录每轮结论/风险/遗留问题。每轮必须更新 notes，必要时重写 plan 使其保持最新。
- 开发分支统一在 git worktree 中进行，遵循“基线分支 → 派生分支 → 迭代 → PR”的流程。
- 与 git/PR 相关的操作仅使用 `gh` 命令（查看 PR、创建 PR、查看 Actions 失败记录）。
- 默认测试命令：单元测试 `yarn test`，e2e 测试 `yarn e2e`，如需调整请在 plan 中显式写出新的命令。

## 步骤 1：初始化与计划
- 新建 AI session，基于 `-t` 任务生成规范分支名（<type>/<slug>），并写入 notes。
- 生成或优化 `plan.md`：
  - 计划仅包含开发相关事项（设计/实现/重构/配置/文档更新），不包含测试、代码质量检查、PR 等环节。
  - 若已有 plan.md 且合理则不改，不合理则优化或重写。
  - 已完成项用 ✅ 标记。

## 步骤 2：执行计划循环
- 每次循环仅执行 plan 中最后一条未完成项。
- 完成后立即在 plan.md 中标记 ✅，并将进展写入 notes。
- 当所有计划项完成时结束循环。

## 步骤 3：代码质量审查
- 新建 AI session，读取项目配置并执行可用的代码质量检查（如 lint/typecheck）。
- 若 AGENTS.md 明确要求跳过，或命令行指定跳过该环节，则直接跳过并记录原因。
- 若检查失败：结束当前 session，创建新的 AI session 进行修复；修复后重新执行质量检查，直到通过。

## 步骤 4：测试
- 新建 AI session，执行单元测试与 e2e 测试。
- 若测试失败：结束当前 session，创建新的 AI session 进行修复；修复后重新执行测试，直到通过。

## 步骤 5：文档更新
- 更新版本号、CHANGELOG、README、docs 等必要文档，并记录到 notes。

## 步骤 6：提交与 PR
- 如参数允许：`git add` → AI 总结变更 → `git commit` → `git push` → `gh pr create`。
- PR 标题/正文使用 AI 总结生成的内容；如配置自动合并则在检查通过后合并。

## 步骤 7：持久化记忆与对话续航
- 每轮结束必须向 notes 追加：
  - 关键决策与理由
  - 代码/测试进展
  - 阻塞与下一步计划
- 当阶段性任务完成或需要清理上下文时，开启新对话并把 plan 与 notes 作为前置信息继续。

## 输出规范
- 在所有目标完成时，输出中加入标记 `<<DONE>>`，外层循环据此停止。
- 优先输出可执行命令与文件路径，便于外层自动化调用。
- 日志/说明保持简洁，用中文短句，避免重复。
